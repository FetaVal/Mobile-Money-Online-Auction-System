{% extends 'base.html' %}

{% block title %}Deposit Funds - AuctionHub{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css">
<style>
    .deposit-container {
        max-width: 800px;
        margin: 2rem auto;
    }
    
    .deposit-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
        text-align: center;
    }
    
    .deposit-section {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }
    
    .section-title {
        font-size: 1.4rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: #334155;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .country-selector {
        margin-bottom: 2rem;
    }
    
    .country-option {
        padding: 1rem;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        margin-bottom: 1rem;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .country-option:hover {
        border-color: #667eea;
        background: #f8fafc;
    }
    
    .country-option.selected {
        border-color: #667eea;
        background: #ede9fe;
    }
    
    .payment-type-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        border-bottom: 2px solid #e2e8f0;
    }
    
    .payment-type-tab {
        flex: 1;
        padding: 15px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        background: white;
        border-bottom: 3px solid transparent;
        font-weight: 600;
        color: #64748b;
    }
    
    .payment-type-tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
    }
    
    .payment-type-tab:hover {
        color: #667eea;
    }
    
    .payment-method {
        padding: 1.5rem;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        margin-bottom: 1rem;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .payment-method:hover {
        border-color: #667eea;
        background: #f8fafc;
    }
    
    .payment-method.selected {
        border-color: #667eea;
        background: #ede9fe;
    }
    
    .payment-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .payment-details {
        flex: 1;
    }
    
    .payment-name {
        font-weight: 600;
        font-size: 1.1rem;
        color: #334155;
    }
    
    .payment-desc {
        font-size: 0.9rem;
        color: #64748b;
    }
    
    .phone-input {
        display: none;
        margin-top: 1rem;
    }
    
    .phone-input.show {
        display: block;
    }
    
    .deposit-btn {
        width: 100%;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border: none;
        padding: 1rem;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .deposit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
    }
    
    .balance-display {
        background: #f8fafc;
        padding: 1rem;
        border-radius: 10px;
        margin-bottom: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
</style>
{% endblock %}

{% block content %}
<div class="container deposit-container">
    <div class="deposit-header">
        <h1><i class="fas fa-plus-circle"></i> Deposit Funds</h1>
        <p style="opacity: 0.9; margin-top: 1rem;">Add money to your wallet securely</p>
    </div>
    
    <div class="deposit-section">
        <div class="balance-display">
            <div>
                <small style="color: #64748b;">Current Balance</small>
                <div style="font-size: 1.5rem; font-weight: 700; color: #334155;">
                    UGX {{ wallet.balance|floatformat:0 }}
                </div>
            </div>
            <i class="fas fa-wallet" style="font-size: 2rem; color: #667eea;"></i>
        </div>
        
        <form method="post" action="{% url 'process_deposit' %}">
            {% csrf_token %}
            
            <div class="section-title">
                <i class="fas fa-money-bill-wave"></i> Deposit Amount
            </div>
            
            <div class="form-group">
                <label for="amount" style="font-weight: 600; color: #334155;">Amount (UGX)</label>
                <input type="number" 
                       class="form-control form-control-lg" 
                       id="amount" 
                       name="amount" 
                       placeholder="Enter amount" 
                       required 
                       min="1000" 
                       step="100"
                       style="border: 2px solid #e2e8f0; border-radius: 10px; padding: 1rem;">
                <small class="text-muted">Minimum deposit: UGX 1,000</small>
            </div>
            
            <div class="section-title" style="margin-top: 2rem;">
                <i class="fas fa-globe"></i> Select Your Country
            </div>
            
            <div class="country-selector">
                {% for country in countries %}
                    <div class="country-option" onclick="selectCountry('{{ country.code }}', '{{ country.name }}')">
                        <input type="radio" 
                               name="country" 
                               value="{{ country.code }}" 
                               id="country-{{ country.code }}" 
                               {% if country.code == 'UG' %}checked{% endif %}>
                        <span class="flag-icon flag-icon-{{ country.code|lower }}" style="font-size: 2rem;"></span>
                        <div>
                            <div style="font-weight: 600;">{{ country.name }}</div>
                            <small style="color: #64748b;">{{ country.currency }}</small>
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <div class="section-title">
                <i class="fas fa-credit-card"></i> Payment Method
            </div>
            
            <div id="local-payments" class="payment-options">
                <div class="payment-type-tabs">
                    <div class="payment-type-tab active" onclick="showPaymentType('local')">
                        üì± Local Payments
                    </div>
                    <div class="payment-type-tab" onclick="showPaymentType('international')">
                        üåç International
                    </div>
                </div>
                
                <div id="local-methods" class="payment-methods">
                    <div class="payment-method" onclick="selectPayment('mtn')">
                        <input type="radio" name="payment_method" value="mtn" id="mtn-payment" required>
                        <div class="payment-icon" style="background: #ffcc00;">
                            üì±
                        </div>
                        <div class="payment-details">
                            <div class="payment-name">MTN Mobile Money</div>
                            <div class="payment-desc">Pay with MTN Mobile Money</div>
                        </div>
                    </div>
                    
                    <div class="payment-method" onclick="selectPayment('airtel')">
                        <input type="radio" name="payment_method" value="airtel" id="airtel-payment">
                        <div class="payment-icon" style="background: #ff0000;">
                            üì≤
                        </div>
                        <div class="payment-details">
                            <div class="payment-name">Airtel Money</div>
                            <div class="payment-desc">Pay with Airtel Money</div>
                        </div>
                    </div>
                    
                    <div class="phone-input" id="mobile-phone-input">
                        <label for="phone_number" style="font-weight: 600; color: #334155;">
                            <i class="fas fa-phone"></i> Phone Number
                        </label>
                        <input type="tel" 
                               class="form-control form-control-lg" 
                               id="phone_number" 
                               name="phone_number" 
                               placeholder="e.g., 0700000000"
                               style="border: 2px solid #e2e8f0; border-radius: 10px; padding: 1rem;">
                        <small class="text-muted">Enter your mobile money number</small>
                    </div>
                </div>
                
                <div id="international-methods" class="payment-methods" style="display: none;">
                    <div class="payment-method" onclick="selectPayment('card')">
                        <input type="radio" name="payment_method" value="card" id="card-payment">
                        <div class="payment-icon">
                            üí≥
                        </div>
                        <div class="payment-details">
                            <div class="payment-name">Credit/Debit Card</div>
                            <div class="payment-desc">Visa, Mastercard, American Express</div>
                        </div>
                    </div>
                    
                    <div class="payment-method" onclick="selectPayment('paypal')">
                        <input type="radio" name="payment_method" value="paypal" id="paypal-payment">
                        <div class="payment-icon" style="background: #0070ba;">
                            <i class="fab fa-paypal"></i>
                        </div>
                        <div class="payment-details">
                            <div class="payment-name">PayPal</div>
                            <div class="payment-desc">Pay securely with PayPal</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <button type="submit" class="deposit-btn" style="margin-top: 2rem;">
                <i class="fas fa-lock"></i> Proceed to Deposit
            </button>
        </form>
    </div>
    
    <div style="text-align: center; color: #64748b; margin-top: 2rem;">
        <i class="fas fa-shield-alt"></i> Your payment is secure and encrypted
    </div>
</div>

<script>
function selectCountry(code, name) {
    document.querySelectorAll('.country-option').forEach(opt => opt.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
    document.getElementById('country-' + code).checked = true;
    
    if (code === 'UG') {
        showPaymentType('local');
    } else {
        showPaymentType('international');
    }
}

function showPaymentType(type) {
    document.querySelectorAll('.payment-type-tab').forEach(tab => tab.classList.remove('active'));
    event.currentTarget.classList.add('active');
    
    if (type === 'local') {
        document.getElementById('local-methods').style.display = 'block';
        document.getElementById('international-methods').style.display = 'none';
    } else {
        document.getElementById('local-methods').style.display = 'none';
        document.getElementById('international-methods').style.display = 'block';
    }
    
    document.querySelectorAll('.payment-method').forEach(method => method.classList.remove('selected'));
    document.querySelectorAll('input[name="payment_method"]').forEach(input => input.checked = false);
    document.getElementById('mobile-phone-input').classList.remove('show');
}

function selectPayment(method) {
    document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
    document.getElementById(method + '-payment').checked = true;
    
    if (method === 'mtn' || method === 'airtel') {
        document.getElementById('mobile-phone-input').classList.add('show');
        document.getElementById('phone_number').required = true;
    } else {
        document.getElementById('mobile-phone-input').classList.remove('show');
        document.getElementById('phone_number').required = false;
    }
}

// Auto-show phone field on page load since MTN is pre-selected
document.addEventListener('DOMContentLoaded', function() {
    const mtnRadio = document.getElementById('mtn-payment');
    if (mtnRadio && mtnRadio.checked) {
        document.getElementById('mobile-phone-input').classList.add('show');
        document.getElementById('phone_number').required = true;
        document.querySelector('[onclick="selectPayment(\'mtn\')"]').classList.add('selected');
    }
});
</script>
{% endblock %}
